package org.campagnelab.hta.tables.typesystem;

/*Generated by MPS */

import jetbrains.mps.errors.QuickFix_Runtime;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import java.io.File;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.internal.collections.runtime.IVisitor;

public class TablePreviewLoader_QuickFix extends QuickFix_Runtime {
  public TablePreviewLoader_QuickFix() {
  }

  public String getDescription(SNode node) {
    return "Load Table Column Preview";
  }

  public void execute(SNode node) {
    // the following will trigger loading the column description for the table 
    SNode table = SConceptOperations.createNewNode("org.campagnelab.hta.tables.structure.Table", null);
    SLinkOperations.setTarget(((SNode) TablePreviewLoader_QuickFix.this.getField("ftable")[0]), "myOwnTable", table, true);
    SLinkOperations.setTarget(((SNode) TablePreviewLoader_QuickFix.this.getField("ftable")[0]), "table", SLinkOperations.getTarget(((SNode) TablePreviewLoader_QuickFix.this.getField("ftable")[0]), "myOwnTable", true), false);
    SPropertyOperations.set(table, "path", ((File) TablePreviewLoader_QuickFix.this.getField("ftableFile")[0]).getAbsolutePath());
    SPropertyOperations.set(table, "name", SPropertyOperations.getString(((SNode) TablePreviewLoader_QuickFix.this.getField("ftable")[0]), "name"));
    // remove quotes from column names: 
    ListSequence.fromList(SLinkOperations.getTargets(table, "columns", true)).visitAll(new IVisitor<SNode>() {
      public void visit(SNode col) {
        SPropertyOperations.set(col, "name", SPropertyOperations.getString(col, "name").split("\"")[1]);
      }
    });

  }
}
